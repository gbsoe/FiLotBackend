# ================================================================
# FiLot Backend Environment Configuration
# ================================================================
# Copy this file to .env and fill in the values
# Required variables are marked with [REQUIRED]
# ================================================================

# ----------------------------------------------------------------
# Core Server Configuration
# ----------------------------------------------------------------
NODE_ENV=development
PORT=8080
UPLOAD_DIR=./uploads

# ----------------------------------------------------------------
# Security [REQUIRED in production]
# ----------------------------------------------------------------
JWT_SECRET=                          # [REQUIRED] Must be set in production
SESSION_SECRET=                      # [REQUIRED] Session encryption key
SERVICE_INTERNAL_KEY=                # [REQUIRED] API key for internal routes
FILOT_FRONTEND_ORIGIN=https://app.filot.id

# ----------------------------------------------------------------
# Database [REQUIRED]
# ----------------------------------------------------------------
DATABASE_URL=                        # [REQUIRED] PostgreSQL connection string
                                     # Format: postgresql://user:pass@host:port/dbname

# ----------------------------------------------------------------
# Stack Auth Configuration [REQUIRED]
# ----------------------------------------------------------------
STACK_PROJECT_ID=                    # [REQUIRED] Stack Auth project ID
STACK_SECRET_SERVER_KEY=             # [REQUIRED] Stack Auth server key
STACK_PUBLISHABLE_CLIENT_KEY=        # [REQUIRED] Stack Auth client key

# ----------------------------------------------------------------
# Cloudflare R2 Storage [REQUIRED]
# ----------------------------------------------------------------
CF_R2_ENDPOINT=                      # [REQUIRED] https://[account-id].r2.cloudflarestorage.com
CF_R2_ACCESS_KEY_ID=                 # [REQUIRED] R2 access key
CF_R2_SECRET_ACCESS_KEY=             # [REQUIRED] R2 secret key
CF_R2_BUCKET_NAME=                   # [REQUIRED] R2 bucket name
CF_ACCOUNT_ID=                       # [REQUIRED] Cloudflare account ID
R2_PRIVATE_URL_EXPIRY=3600           # Presigned URL expiry in seconds

# ----------------------------------------------------------------
# Redis Configuration [REQUIRED for queue operations]
# ----------------------------------------------------------------
REDIS_URL=redis://localhost:6379     # [REQUIRED] Redis connection URL
                                     # Use rediss:// for TLS connections
REDIS_PASSWORD=                      # Redis password (if required)
REDIS_TLS=false                      # Enable TLS for Redis connection

# ----------------------------------------------------------------
# BULI2 Integration [REQUIRED for manual review flow]
# ----------------------------------------------------------------
BULI2_API_URL=https://buli2.example.internal    # [REQUIRED] BULI2 API endpoint
BULI2_API_KEY=                                   # [REQUIRED in production] BULI2 API key
BULI2_CALLBACK_URL=https://filot.example.internal/internal/reviews
BULI2_SIGNATURE_SECRET=                          # HMAC signature secret for callbacks

# ----------------------------------------------------------------
# AI Scoring Configuration
# ----------------------------------------------------------------
AI_SCORE_THRESHOLD_AUTO_APPROVE=85   # Score >= this = auto approve
AI_SCORE_THRESHOLD_AUTO_REJECT=35    # Score <= this = auto reject

# ----------------------------------------------------------------
# OCR Engine Configuration
# ----------------------------------------------------------------
OCR_ENGINE=redis                     # Options: redis, temporal
OCR_AUTOFALLBACK=true                # Fallback to CPU if GPU fails

# ----------------------------------------------------------------
# Temporal Configuration (optional workflow orchestration)
# ----------------------------------------------------------------
TEMPORAL_DISABLED=true               # Set to false to enable Temporal
TEMPORAL_ENDPOINT=                   # Temporal Cloud endpoint
TEMPORAL_NAMESPACE=                  # Temporal namespace
TEMPORAL_API_KEY=                    # Temporal API key
TEMPORAL_TASK_QUEUE=filot-ocr        # Temporal task queue name

# ----------------------------------------------------------------
# GPU OCR Worker Configuration
# ----------------------------------------------------------------
OCR_GPU_ENABLED=false                # Enable GPU OCR processing
OCR_GPU_QUEUE_KEY=filot:ocr:gpu:queue
OCR_GPU_PROCESSING_KEY=filot:ocr:gpu:processing
OCR_GPU_PUBLISH_CHANNEL=filot:ocr:gpu:results
OCR_GPU_CONCURRENCY=2                # Max concurrent GPU jobs
OCR_GPU_POLL_INTERVAL=1000           # Poll interval in ms
OCR_GPU_AUTOFALLBACK=true            # Fallback to CPU if GPU fails
OCR_GPU_MAX_RETRIES=3                # Max retries before fallback
OCR_GPU_ATTEMPTS_KEY=filot:ocr:gpu:attempts
NVIDIA_VISIBLE_DEVICES=              # GPU device IDs (empty = auto, "none" = disable)

# ----------------------------------------------------------------
# AWS Configuration (for GPU worker ECS deployment)
# ----------------------------------------------------------------
AWS_REGION=ap-southeast-2
AWS_ACCOUNT_ID=
ECR_REPOSITORY=filot-ocr-gpu-worker
ECS_CLUSTER=filot-production
ECS_SERVICE=filot-ocr-gpu-worker

# ----------------------------------------------------------------
# Observability & Metrics Configuration
# ----------------------------------------------------------------
LOG_LEVEL=info                       # Options: debug, info, warn, error
CLOUDWATCH_ENABLED=false             # Enable CloudWatch metrics
CLOUDWATCH_LOG_GROUP=/ecs/filot-ocr-gpu-worker
METRICS_ENABLED=true                 # Enable metrics emission
METRICS_NAMESPACE=FiLot              # CloudWatch metrics namespace
METRICS_BATCH_SIZE=10                # Flush buffer after N metrics
METRICS_FLUSH_INTERVAL_MS=60000      # Auto-flush interval (60s)

# ----------------------------------------------------------------
# GPU Worker Stuck Job Recovery
# ----------------------------------------------------------------
OCR_GPU_STUCK_TIMEOUT=300000         # Stuck job timeout (5 min)
OCR_GPU_REAPER_INTERVAL=60000        # Reaper interval (60 sec)
OCR_GPU_LOCK_TTL=600                 # Lock TTL in seconds
