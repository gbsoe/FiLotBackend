# ================================================================
# FiLot Backend - Production Environment Template
# ================================================================
# Generated: 2024-11-30 (Tranche T8-A)
# 
# IMPORTANT: This file contains ALL required environment variables
# for production deployment. Variables marked [REQUIRED] MUST be set.
# Variables marked [CRITICAL] are security-sensitive and must use
# strong, unique values.
# ================================================================

# ----------------------------------------------------------------
# CORE SERVER CONFIGURATION
# ----------------------------------------------------------------
NODE_ENV=production
PORT=8080
UPLOAD_DIR=/app/uploads

# ----------------------------------------------------------------
# SECURITY CONFIGURATION [CRITICAL]
# ----------------------------------------------------------------
# All security secrets MUST be unique, randomly generated strings
# Minimum 32 characters recommended for production

JWT_SECRET=                              # [REQUIRED][CRITICAL] JWT signing key (min 32 chars)
SESSION_SECRET=                          # [REQUIRED][CRITICAL] Session encryption key (min 32 chars)
SERVICE_INTERNAL_KEY=                    # [REQUIRED][CRITICAL] Internal API authentication key

# CORS Configuration
FILOT_FRONTEND_ORIGIN=https://app.filot.me

# ----------------------------------------------------------------
# DATABASE CONFIGURATION [REQUIRED]
# ----------------------------------------------------------------
DATABASE_URL=                            # [REQUIRED] PostgreSQL connection string
                                         # Format: postgresql://user:password@host:port/database?sslmode=require

# ----------------------------------------------------------------
# STACK AUTH CONFIGURATION [REQUIRED]
# ----------------------------------------------------------------
STACK_PROJECT_ID=                        # [REQUIRED] Stack Auth project ID
STACK_SECRET_SERVER_KEY=                 # [REQUIRED] Stack Auth server key
STACK_PUBLISHABLE_CLIENT_KEY=            # [REQUIRED] Stack Auth client key

# ----------------------------------------------------------------
# CLOUDFLARE R2 STORAGE [REQUIRED]
# ----------------------------------------------------------------
CF_ACCOUNT_ID=                           # [REQUIRED] Cloudflare account ID
CF_R2_ENDPOINT=                          # [REQUIRED] https://<account-id>.r2.cloudflarestorage.com
CF_R2_ACCESS_KEY_ID=                     # [REQUIRED] R2 API token access key
CF_R2_SECRET_ACCESS_KEY=                 # [REQUIRED][CRITICAL] R2 API token secret key
CF_R2_BUCKET_NAME=                       # [REQUIRED] R2 bucket name (e.g., filot-documents)
R2_PRIVATE_URL_EXPIRY=3600               # Presigned URL expiry in seconds

# ----------------------------------------------------------------
# REDIS CONFIGURATION [REQUIRED]
# ----------------------------------------------------------------
# Production Redis MUST use TLS (rediss://) and authentication

REDIS_URL=                               # [REQUIRED] Redis connection URL
                                         # Format: rediss://user:password@host:port
REDIS_PASSWORD=                          # [REQUIRED] Redis authentication password
REDIS_HOST=                              # Redis host (if not using URL)
REDIS_PORT=6379                          # Redis port
REDIS_USERNAME=default                   # Redis username (for ACL)
REDIS_TLS=true                           # [REQUIRED] Enable TLS for production
QUEUE_PREFIX=filot:prod                  # Queue key prefix for production namespace

# ----------------------------------------------------------------
# BULI2 INTEGRATION [REQUIRED FOR MANUAL REVIEW]
# ----------------------------------------------------------------
BULI2_API_URL=                           # [REQUIRED] BULI2 service endpoint
                                         # Format: https://buli2.internal.filot.me
BULI2_API_KEY=                           # [REQUIRED][CRITICAL] BULI2 API authentication key
BULI2_CALLBACK_URL=                      # [REQUIRED] Callback URL for review decisions
                                         # Format: https://api.filot.me/internal/reviews
BULI2_SIGNATURE_SECRET=                  # [CRITICAL] HMAC secret for callback verification

# AI Scoring Thresholds
AI_SCORE_THRESHOLD_AUTO_APPROVE=85       # Score >= this = auto approve
AI_SCORE_THRESHOLD_AUTO_REJECT=35        # Score <= this = auto reject

# ----------------------------------------------------------------
# OCR ENGINE CONFIGURATION
# ----------------------------------------------------------------
OCR_ENGINE=redis                         # Queue engine: redis or temporal
OCR_AUTOFALLBACK=true                    # Fallback to CPU if GPU fails

# ----------------------------------------------------------------
# TEMPORAL CLOUD CONFIGURATION [OPTIONAL]
# ----------------------------------------------------------------
# Required if using Temporal for workflow orchestration

TEMPORAL_DISABLED=false                  # Set to false to enable Temporal
TEMPORAL_ENDPOINT=                       # Temporal Cloud gRPC endpoint
                                         # Format: <namespace>.tmprl.cloud:7233
TEMPORAL_ADDRESS=                        # Alternative to TEMPORAL_ENDPOINT
TEMPORAL_NAMESPACE=                      # [REQUIRED] Temporal namespace
TEMPORAL_API_KEY=                        # [CRITICAL] Temporal Cloud API key
TEMPORAL_TASK_QUEUE=filot-ocr            # Temporal task queue name

# ----------------------------------------------------------------
# GPU OCR WORKER CONFIGURATION
# ----------------------------------------------------------------
# For ECS GPU worker deployment

OCR_GPU_ENABLED=true                     # Enable GPU OCR processing
OCR_GPU_QUEUE_KEY=filot:ocr:gpu:queue    # Redis queue key for GPU jobs
OCR_GPU_PROCESSING_KEY=filot:ocr:gpu:processing
OCR_GPU_PUBLISH_CHANNEL=filot:ocr:gpu:results
OCR_GPU_CONCURRENCY=4                    # Max concurrent GPU jobs
OCR_GPU_POLL_INTERVAL=1000               # Poll interval in ms
OCR_GPU_AUTOFALLBACK=true                # Fallback to CPU if GPU fails
OCR_GPU_MAX_RETRIES=3                    # Max retries before fallback
OCR_GPU_ATTEMPTS_KEY=filot:ocr:gpu:attempts
OCR_GPU_STUCK_TIMEOUT=300000             # Stuck job timeout (5 min)
OCR_GPU_REAPER_INTERVAL=60000            # Reaper interval (60 sec)
OCR_GPU_LOCK_TTL=600                     # Lock TTL in seconds
NVIDIA_VISIBLE_DEVICES=all               # GPU devices (all, 0, 1, none)

# ----------------------------------------------------------------
# AWS ECS DEPLOYMENT CONFIGURATION
# ----------------------------------------------------------------
AWS_REGION=ap-southeast-2
AWS_ACCOUNT_ID=                          # [REQUIRED] AWS account ID
ECR_REPOSITORY=filot-ocr-gpu-worker
ECS_CLUSTER=filot-production
ECS_SERVICE=filot-ocr-gpu-worker

# ----------------------------------------------------------------
# OBSERVABILITY & METRICS
# ----------------------------------------------------------------
LOG_LEVEL=info                           # Options: debug, info, warn, error
CLOUDWATCH_ENABLED=true                  # Enable CloudWatch metrics
CLOUDWATCH_LOG_GROUP=/ecs/filot-backend
METRICS_ENABLED=true                     # Enable metrics emission
METRICS_NAMESPACE=FiLot                  # CloudWatch metrics namespace
METRICS_BATCH_SIZE=10                    # Flush buffer after N metrics
METRICS_FLUSH_INTERVAL_MS=60000          # Auto-flush interval (60s)

# ================================================================
# END OF PRODUCTION CONFIGURATION
# ================================================================
